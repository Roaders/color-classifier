/*!
 * color-classifier
 * Classify the color along the reference color.
 *
 * @author tsuyoshiwada
 * @license MIT
 * @version 0.0.1
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.ColorClassifier=r()}(this,function(){"use strict";function e(e,r){var t=[].concat(f.toConsumableArray(e));return t.sort(function(e,t){return e[r]<t[r]?-1:e[r]>t[r]?1:0}),t.shift()}function r(e,r){if(!r)return e;var t={};for(var n in e)t[n]=Math.round(e[n]);return t}function t(e,r){return e.hasOwnProperty(r)}function n(e){return t(e,"r")&&t(e,"g")&&t(e,"b")}function o(e){return e*Math.PI/180}function a(e){return e*(180/Math.PI)}function i(e,r){return Math.sqrt(e*e+r*r)}function u(e){return e*e}function l(e){return e*e*e*e*e*e*e}function c(e,r){if(e===r)return!0;var t=void 0,n=void 0;try{t=Object.keys(e),n=Object.keys(r)}catch(o){return!1}if(t.length!==n.length)return!1;for(var a=0;t.length-1;a++){var i=t[a];if(e[i]!==r[i])return!1}return("undefined"==typeof e?"undefined":f["typeof"](e))===("undefined"==typeof r?"undefined":f["typeof"](r))}var f={};f["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},f.classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},f.createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),f.defineProperty=function(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e},f.slicedToArray=function(){function e(e,r){var t=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(l){o=!0,a=l}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw a}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f.toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)};var h,s=/^#([a-fA-F0-9]{3})$/,y=/^#([a-fA-F0-9]{6})$/,b=function(){function e(r){f.classCallCheck(this,e),this.original=r,n(r)?(this.rgb=r,this.hex=e.rgbToHex(r)):(this.hex=e.normalizeHex(r),this.rgb=e.hexToRgb(this.hex)),this.hsv=e.rgbToHsv(this.rgb)}return f.createClass(e,null,[{key:"normalizeHex",value:function(e){if(y.test(e))return e;if(s.test(e)){var r=e.slice(1,2),t=e.slice(2,3),n=e.slice(3,4);return"#"+(r+r)+(t+t)+(n+n)}return null}},{key:"hexToRgb",value:function(e){var r=this.normalizeHex(e);if(null==r)return null;var t=r.match(y),n=parseInt(t[1],16),o=n>>16&255,a=n>>8&255,i=255&n;return{r:o,g:a,b:i}}},{key:"rgbToHex",value:function(e){var r=e.r,t=e.g,n=e.b,o=((255&Math.round(r))<<16)+((255&Math.round(t))<<8)+(255&Math.round(n)),a=o.toString(16).toLowerCase();return"#"+("000000".substring(a.length)+a)}},{key:"rgbToHsv",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=e.r,o=e.g,a=e.b,i=Math.min(n,o,a),u=Math.max(n,o,a),l=u-i,c={};return 0===u?c.s=0:c.s=l/u*1e3/10,u===i?c.h=0:n===u?c.h=(o-a)/l:o===u?c.h=2+(a-n)/l:c.h=4+(n-o)/l,c.h=Math.min(60*c.h,360),c.h=c.h<0?c.h+360:c.h,c.v=u/255*1e3/10,r(c,t)}},{key:"rgbToXyz",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=e.r/255,o=e.g/255,a=e.b/255,i=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,u=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,l=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,c=100*(.4124*i+.3576*u+.1805*l),f=100*(.2126*i+.7152*u+.0722*l),h=100*(.0193*i+.1192*u+.9505*l);return r({x:c,y:f,z:h},t)}},{key:"rgbToLab",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],o=e.rgbToXyz(t,!1),a=o.x,i=o.y,u=o.z;a/=95.047,i/=100,u/=108.883,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,u=u>.008856?Math.pow(u,1/3):7.787*u+16/116;var l=116*i-16,c=500*(a-i),f=200*(i-u);return r({l:l,a:c,b:f},n)}}]),e}(),v=Math.abs,d=Math.atan2,g=Math.cos,p=Math.min,m=Math.exp,C=Math.sqrt,F=Math.sin,w={CIEDE2000:"CIEDE2000",HSV:"HSV",RGB:"RGB"},k=(h={},f.defineProperty(h,w.CIEDE2000,"ciede2000"),f.defineProperty(h,w.HSV,"hsv"),f.defineProperty(h,w.RGB,"rgb"),h),M=1,T=1,A=1,x=l(25),E=function(){function e(){f.classCallCheck(this,e)}return f.createClass(e,null,[{key:"diff",value:function(r,t,n){var o=k[r];return e[o](t,n)}},{key:"ciede2000",value:function(r,t){var n=b.rgbToLab(r.rgb),o=b.rgbToLab(t.rgb);return e._ciede2000(n.l,n.a,n.b,o.l,o.a,o.b)}},{key:"_ciede2000",value:function(e,r,t,n,c,f){var h=i(r,t),s=i(c,f),y=(h+s)/2,b=.5*(1-C(l(y)/(l(y)+x))),p=(1+b)*r,w=(1+b)*c,k=C(u(p)+u(t)),E=C(u(w)+u(f)),P=a(d(t,p)),S=0===t&&0===p?0:P>0?P:P+360,H=a(d(f,w)),z=0===f&&0===w?0:H>0?H:H+360,I=n-e,O=E-k,j=2*C(k*E)*F(o(h*s===0?0:v(z-S)<=180?z-S:z-S>180?z-S-360:z-S+360)/2),R=(e+n)/2,D=(k+E)/2,L=void 0;L=h*s===0?S+z:v(S-z)<=180?(S+z)/2:v(S-z)>180&&360>S+z?(S+z+360)/2:(S+z-360)/2;var B=1-.17*g(o(L-30))+.24*g(o(2*L))+.32*g(o(3*L+6))-.2*g(o(4*L-63)),G=30*m(-u((L-275)/25)),V=C(l(D)/(l(D)+x)),q=1+.015*u(R-50)/C(20+u(R-50)),X=1+.045*D,$=1+.015*D*B,_=-2*V*F(o(2*G));return C(u(I/(q*M))+u(O/(X*T))+u(j/($*A))+_*(O/(X*T))*(j/($*A)))}},{key:"hsv",value:function(e,r){var t=e.hsv,n=e.hsv,o=0;return o=t.h>n.h?p(t.h-n.h,n.h-t.h+360):p(n.h-t.h,t.h-n.h+360),C(u(o)+u(t.s-n.s)+u(t.v-n.v))}},{key:"rgb",value:function(e,r){var t=e.rgb,n=r.rgb;return C(u(t.r-n.r)+u(t.g-n.g)+u(t.b-n.b))}}]),e}(),P=["#000000","#C0C0C0","#808080","#FFFFFF","#800000","#FF0000","#800080","#FF00FF","#008000","#00FF00","#808000","#FFFF00","#000080","#0000FF","#008080","#00FFFF"],S=["#b5184f","#cd1f42","#dd3737","#e55125","#e66d00","#f29500","#eeac00","#e2c500","#c8bb00","#a4b300","#4aa315","#009a55","#008c69","#007e77","#007c8c","#006b93","#005a91","#00569c","#00509d","#474798","#663e8c","#793580","#892c71","#ab2664","#efefef","#d2d2d2","#b6b6b6","#9b9b9b","#818181","#696969","#525252","#3c3c3c","#292929"],H=Object.freeze({W3C:P,PCCS:S}),z=function(){function r(){var e=arguments.length<=0||void 0===arguments[0]?P:arguments[0],t=arguments.length<=1||void 0===arguments[1]?w.CIEDE2000:arguments[1];f.classCallCheck(this,r),this.setPalette(e),this.setAlgorithmType(t)}return f.createClass(r,null,[{key:"throwError",value:function(e){throw new Error("[ColorClassifier] "+e)}}]),f.createClass(r,[{key:"setPalette",value:function(e){Array.isArray(e)||r.throwError("palette is should be a Array."),this.palette=e.map(function(e){return new b(e)})}},{key:"getPalette",value:function(){return this.palette}},{key:"setAlgorithmType",value:function(e){w.hasOwnProperty(e)||r.throwError(e+" is an undefined algorithm type."),this.algorithmType=e}},{key:"getAlgorithmType",value:function(){return this.algorithmType}},{key:"classify",value:function(r){var t=arguments.length<=1||void 0===arguments[1]?"rgb":arguments[1],n=this.palette,o=this.algorithmType,a=new b(r),i=[];return n.forEach(function(e){i.push({distance:E.diff(o,e,a),color:"raw"===t?e:e[t]})}),e(i,"distance").color}},{key:"classifyFromArray",value:function(e){var r=this,t=arguments.length<=1||void 0===arguments[1]?"rgb":arguments[1],n=[],o=[];return e.forEach(function(e){var t=new b(e),n=r.classify(t.rgb,"raw");o.push({palette:n,color:t})}),o.forEach(function(e){var r=e.palette,o=e.color,a=n.filter(function(e){return c(e.palette?e.palette[t]:null,r[t])}),i=f.slicedToArray(a,1),u=i[0];u?u.colors.push(o[t]):n.push({palette:r[t],colors:[o[t]]})}),n}}]),r}();return z.Palette=H,z.AlgorithmTypes=w,z});