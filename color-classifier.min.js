/*!
 * color-classifier
 * Classify the color along the reference color.
 *
 * @author tsuyoshiwada
 * @license MIT
 * @version 0.0.1
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.ColorClassifier=r()}(this,function(){"use strict";function e(e,r){var t=[].concat(u.toConsumableArray(e));return t.sort(function(e,t){return e[r]<t[r]?-1:e[r]>t[r]?1:0}),t.shift()}function r(e,r){if(!r)return e;var t={};for(var n in e)t[n]=Math.round(e[n]);return t}function t(e){return e*Math.PI/180}function n(e){return e*(180/Math.PI)}function a(e,r){return Math.sqrt(e*e+r*r)}function i(e){return e*e}function o(e){return e*e*e*e*e*e*e}var u={};u.classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},u.createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),u.defineProperty=function(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e},u.toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)};var l,h=/^#([a-fA-F0-9]{3})$/,c=/^#([a-fA-F0-9]{6})$/,s=function(){function e(r){u.classCallCheck(this,e),this.original=r,this.hex=e.normalizeHex(r),this.rgb=e.hexToRgb(this.hex),this.hsv=e.rgbToHsv(this.rgb)}return u.createClass(e,null,[{key:"normalizeHex",value:function(e){if(c.test(e))return e;if(h.test(e)){var r=e.slice(1,2),t=e.slice(2,3),n=e.slice(3,4);return"#"+(r+r)+(t+t)+(n+n)}return null}},{key:"hexToRgb",value:function(e){var r=this.normalizeHex(e);if(null==r)return null;var t=r.match(c),n=parseInt(t[1],16),a=n>>16&255,i=n>>8&255,o=255&n;return{r:a,g:i,b:o}}},{key:"rgbToHsv",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=e.r,a=e.g,i=e.b,o=Math.min(n,a,i),u=Math.max(n,a,i),l=u-o,h={};return 0===u?h.s=0:h.s=l/u*1e3/10,u===o?h.h=0:n===u?h.h=(a-i)/l:a===u?h.h=2+(i-n)/l:h.h=4+(n-a)/l,h.h=Math.min(60*h.h,360),h.h=h.h<0?h.h+360:h.h,h.v=u/255*1e3/10,r(h,t)}},{key:"rgbToXyz",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=e.r/255,a=e.g/255,i=e.b/255,o=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,u=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,l=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,h=100*(.4124*o+.3576*u+.1805*l),c=100*(.2126*o+.7152*u+.0722*l),s=100*(.0193*o+.1192*u+.9505*l);return r({x:h,y:c,z:s},t)}},{key:"rgbToLab",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],a=e.rgbToXyz(t,!1),i=a.x,o=a.y,u=a.z;i/=95.047,o/=100,u/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,u=u>.008856?Math.pow(u,1/3):7.787*u+16/116;var l=116*o-16,h=500*(i-o),c=200*(o-u);return r({l:l,a:h,b:c},n)}}]),e}(),f=Math.abs,v=Math.atan2,y=Math.cos,b=Math.min,g=Math.exp,d=Math.sqrt,p=Math.sin,C={CIEDE2000:"CIEDE2000",HSV:"HSV",RGB:"RGB"},m=(l={},u.defineProperty(l,C.CIEDE2000,"ciede2000"),u.defineProperty(l,C.HSV,"hsv"),u.defineProperty(l,C.RGB,"rgb"),l),F=1,k=1,M=1,w=o(25),T=function(){function e(){u.classCallCheck(this,e)}return u.createClass(e,null,[{key:"diff",value:function(r,t,n){var a=m[r];return e[a](t,n)}},{key:"ciede2000",value:function(r,t){var n=s.rgbToLab(r.rgb),a=s.rgbToLab(t.rgb);return e._ciede2000(n.l,n.a,n.b,a.l,a.a,a.b)}},{key:"_ciede2000",value:function(e,r,u,l,h,c){var s=a(r,u),b=a(h,c),C=(s+b)/2,m=.5*(1-d(o(C)/(o(C)+w))),T=(1+m)*r,A=(1+m)*h,E=d(i(T)+i(u)),P=d(i(A)+i(c)),x=n(v(u,T)),z=0===u&&0===T?0:x>0?x:x+360,H=n(v(c,A)),I=0===c&&0===A?0:H>0?H:H+360,O=l-e,R=P-E,j=2*d(E*P)*p(t(s*b===0?0:f(I-z)<=180?I-z:I-z>180?I-z-360:I-z+360)/2),D=(e+l)/2,S=(E+P)/2,B=void 0;B=s*b===0?z+I:f(z-I)<=180?(z+I)/2:f(z-I)>180&&360>z+I?(z+I+360)/2:(z+I-360)/2;var G=1-.17*y(t(B-30))+.24*y(t(2*B))+.32*y(t(3*B+6))-.2*y(t(4*B-63)),L=30*g(-i((B-275)/25)),V=d(o(S)/(o(S)+w)),q=1+.015*i(D-50)/d(20+i(D-50)),X=1+.045*S,$=1+.015*S*G,_=-2*V*p(t(2*L));return d(i(O/(q*F))+i(R/(X*k))+i(j/($*M))+_*(R/(X*k))*(j/($*M)))}},{key:"hsv",value:function(e,r){var t=e.hsv,n=e.hsv,a=0;return a=t.h>n.h?b(t.h-n.h,n.h-t.h+360):b(n.h-t.h,t.h-n.h+360),d(i(a)+i(t.s-n.s)+i(t.v-n.v))}},{key:"rgb",value:function(e,r){var t=e.rgb,n=r.rgb;return d(i(t.r-n.r)+i(t.g-n.g)+i(t.b-n.b))}}]),e}(),A=["#000000","#C0C0C0","#808080","#FFFFFF","#800000","#FF0000","#800080","#FF00FF","#008000","#00FF00","#808000","#FFFF00","#000080","#0000FF","#008080","#00FFFF"],E=["#b5184f","#cd1f42","#dd3737","#e55125","#e66d00","#f29500","#eeac00","#e2c500","#c8bb00","#a4b300","#4aa315","#009a55","#008c69","#007e77","#007c8c","#006b93","#005a91","#00569c","#00509d","#474798","#663e8c","#793580","#892c71","#ab2664","#efefef","#d2d2d2","#b6b6b6","#9b9b9b","#818181","#696969","#525252","#3c3c3c","#292929"],P=Object.freeze({W3C:A,PCCS:E}),x=function(){function r(){var e=arguments.length<=0||void 0===arguments[0]?A:arguments[0],t=arguments.length<=1||void 0===arguments[1]?C.CIEDE2000:arguments[1];u.classCallCheck(this,r),this.setPalette(e),this.setAlgorithmType(t)}return u.createClass(r,null,[{key:"throwError",value:function(e){throw new Error("[ColorClassifier] "+e)}}]),u.createClass(r,[{key:"setPalette",value:function(e){Array.isArray(e)||r.throwError("palette is should be a Array."),this.palette=e.map(function(e){return new s(e)})}},{key:"getPalette",value:function(){return this.palette}},{key:"setAlgorithmType",value:function(e){C.hasOwnProperty(e)||r.throwError(e+" is an undefined algorithm type."),this.algorithmType=e}},{key:"getAlgorithmType",value:function(){return this.algorithmType}},{key:"classify",value:function(r){var t=this.palette,n=this.algorithmType,a=new s(r),i=[];return t.forEach(function(e){i.push({distance:T.diff(n,e,a),color:e.original})}),e(i,"distance").color}},{key:"classifyFromArray",value:function(e){var r=this,t={};return e.forEach(function(e){var n=r.classify(e);t.hasOwnProperty(n)||(t[n]=[]),t[n].push(e)}),t}}]),r}();return x.Palette=P,x.AlgorithmTypes=C,x});