/*!
 * color-classifier
 * Classify the color along the reference color.
 *
 * @author tsuyoshiwada
 * @license MIT
 * @version 0.0.1
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.ColorClassifier=r()}(this,function(){"use strict";function e(e,r){var t=[].concat(l.toConsumableArray(e));return t.sort(function(e,t){return e[r]<t[r]?-1:e[r]>t[r]?1:0}),t.shift()}function r(e,r){if(!r)return e;var t={};for(var n in e)t[n]=Math.round(e[n]);return t}function t(e,r){return e.hasOwnProperty(r)}function n(e){return t(e,"r")&&t(e,"g")&&t(e,"b")}function a(e){return e*Math.PI/180}function o(e){return e*(180/Math.PI)}function i(e,r){return Math.sqrt(e*e+r*r)}function u(e){return e*e}function h(e){return e*e*e*e*e*e*e}var l={};l.classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},l.createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),l.defineProperty=function(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e},l.toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)};var s,c=/^#([a-fA-F0-9]{3})$/,f=/^#([a-fA-F0-9]{6})$/,v=function(){function e(r){l.classCallCheck(this,e),this.original=r,n(r)?(this.rgb=r,this.hex=e.rgbToHex(r)):(this.hex=e.normalizeHex(r),this.rgb=e.hexToRgb(this.hex)),this.hsv=e.rgbToHsv(this.rgb)}return l.createClass(e,null,[{key:"normalizeHex",value:function(e){if(f.test(e))return e;if(c.test(e)){var r=e.slice(1,2),t=e.slice(2,3),n=e.slice(3,4);return"#"+(r+r)+(t+t)+(n+n)}return null}},{key:"hexToRgb",value:function(e){var r=this.normalizeHex(e);if(null==r)return null;var t=r.match(f),n=parseInt(t[1],16),a=n>>16&255,o=n>>8&255,i=255&n;return{r:a,g:o,b:i}}},{key:"rgbToHex",value:function(e){var r=e.r,t=e.g,n=e.b,a=((255&Math.round(r))<<16)+((255&Math.round(t))<<8)+(255&Math.round(n)),o=a.toString(16).toLowerCase();return"#"+("000000".substring(o.length)+o)}},{key:"rgbToHsv",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=e.r,a=e.g,o=e.b,i=Math.min(n,a,o),u=Math.max(n,a,o),h=u-i,l={};return 0===u?l.s=0:l.s=h/u*1e3/10,u===i?l.h=0:n===u?l.h=(a-o)/h:a===u?l.h=2+(o-n)/h:l.h=4+(n-a)/h,l.h=Math.min(60*l.h,360),l.h=l.h<0?l.h+360:l.h,l.v=u/255*1e3/10,r(l,t)}},{key:"rgbToXyz",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=e.r/255,a=e.g/255,o=e.b/255,i=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,u=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,h=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,l=100*(.4124*i+.3576*u+.1805*h),s=100*(.2126*i+.7152*u+.0722*h),c=100*(.0193*i+.1192*u+.9505*h);return r({x:l,y:s,z:c},t)}},{key:"rgbToLab",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],a=e.rgbToXyz(t,!1),o=a.x,i=a.y,u=a.z;o/=95.047,i/=100,u/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,u=u>.008856?Math.pow(u,1/3):7.787*u+16/116;var h=116*i-16,l=500*(o-i),s=200*(i-u);return r({l:h,a:l,b:s},n)}}]),e}(),b=Math.abs,y=Math.atan2,g=Math.cos,d=Math.min,p=Math.exp,C=Math.sqrt,m=Math.sin,F={CIEDE2000:"CIEDE2000",HSV:"HSV",RGB:"RGB"},k=(s={},l.defineProperty(s,F.CIEDE2000,"ciede2000"),l.defineProperty(s,F.HSV,"hsv"),l.defineProperty(s,F.RGB,"rgb"),s),M=1,w=1,T=1,x=h(25),A=function(){function e(){l.classCallCheck(this,e)}return l.createClass(e,null,[{key:"diff",value:function(r,t,n){var a=k[r];return e[a](t,n)}},{key:"ciede2000",value:function(r,t){var n=v.rgbToLab(r.rgb),a=v.rgbToLab(t.rgb);return e._ciede2000(n.l,n.a,n.b,a.l,a.a,a.b)}},{key:"_ciede2000",value:function(e,r,t,n,l,s){var c=i(r,t),f=i(l,s),v=(c+f)/2,d=.5*(1-C(h(v)/(h(v)+x))),F=(1+d)*r,k=(1+d)*l,A=C(u(F)+u(t)),P=C(u(k)+u(s)),E=o(y(t,F)),H=0===t&&0===F?0:E>0?E:E+360,z=o(y(s,k)),I=0===s&&0===k?0:z>0?z:z+360,O=n-e,R=P-A,S=2*C(A*P)*m(a(c*f===0?0:b(I-H)<=180?I-H:I-H>180?I-H-360:I-H+360)/2),j=(e+n)/2,D=(A+P)/2,L=void 0;L=c*f===0?H+I:b(H-I)<=180?(H+I)/2:b(H-I)>180&&360>H+I?(H+I+360)/2:(H+I-360)/2;var B=1-.17*g(a(L-30))+.24*g(a(2*L))+.32*g(a(3*L+6))-.2*g(a(4*L-63)),G=30*p(-u((L-275)/25)),V=C(h(D)/(h(D)+x)),q=1+.015*u(j-50)/C(20+u(j-50)),X=1+.045*D,$=1+.015*D*B,_=-2*V*m(a(2*G));return C(u(O/(q*M))+u(R/(X*w))+u(S/($*T))+_*(R/(X*w))*(S/($*T)))}},{key:"hsv",value:function(e,r){var t=e.hsv,n=e.hsv,a=0;return a=t.h>n.h?d(t.h-n.h,n.h-t.h+360):d(n.h-t.h,t.h-n.h+360),C(u(a)+u(t.s-n.s)+u(t.v-n.v))}},{key:"rgb",value:function(e,r){var t=e.rgb,n=r.rgb;return C(u(t.r-n.r)+u(t.g-n.g)+u(t.b-n.b))}}]),e}(),P=["#000000","#C0C0C0","#808080","#FFFFFF","#800000","#FF0000","#800080","#FF00FF","#008000","#00FF00","#808000","#FFFF00","#000080","#0000FF","#008080","#00FFFF"],E=["#b5184f","#cd1f42","#dd3737","#e55125","#e66d00","#f29500","#eeac00","#e2c500","#c8bb00","#a4b300","#4aa315","#009a55","#008c69","#007e77","#007c8c","#006b93","#005a91","#00569c","#00509d","#474798","#663e8c","#793580","#892c71","#ab2664","#efefef","#d2d2d2","#b6b6b6","#9b9b9b","#818181","#696969","#525252","#3c3c3c","#292929"],H=Object.freeze({W3C:P,PCCS:E}),z=function(){function r(){var e=arguments.length<=0||void 0===arguments[0]?P:arguments[0],t=arguments.length<=1||void 0===arguments[1]?F.CIEDE2000:arguments[1];l.classCallCheck(this,r),this.setPalette(e),this.setAlgorithmType(t)}return l.createClass(r,null,[{key:"throwError",value:function(e){throw new Error("[ColorClassifier] "+e)}}]),l.createClass(r,[{key:"setPalette",value:function(e){Array.isArray(e)||r.throwError("palette is should be a Array."),this.palette=e.map(function(e){return new v(e)})}},{key:"getPalette",value:function(){return this.palette}},{key:"setAlgorithmType",value:function(e){F.hasOwnProperty(e)||r.throwError(e+" is an undefined algorithm type."),this.algorithmType=e}},{key:"getAlgorithmType",value:function(){return this.algorithmType}},{key:"classify",value:function(r){var t=this.palette,n=this.algorithmType,a=new v(r),o=[];return t.forEach(function(e){o.push({distance:A.diff(n,e,a),color:e.original})}),e(o,"distance").color}},{key:"classifyFromArray",value:function(e){var r=this,t={};return e.forEach(function(e){var n=r.classify(e);t.hasOwnProperty(n)||(t[n]=[]),t[n].push(e)}),t}}]),r}();return z.Palette=H,z.AlgorithmTypes=F,z});